<?xml version="1.0" encoding="utf-8" ?>
<toolkit:Popup
    x:Class="BattleMapMain.Views.MiniPickerView"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:Models="clr-namespace:BattleMapMain.Models"
    xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
    xmlns:viewmodels="clr-namespace:BattleMapMain.ViewModels"
    CanBeDismissedByTappingOutsideOfPopup="True"
    Color="White">

    <VerticalStackLayout Padding="16" Spacing="12" x:Name="layout">

        <Entry
            HeightRequest="50"
            Placeholder="Search by name"
            Text="{Binding SearchBar}"
            BackgroundColor="White"
            TextColor="Black"
            PlaceholderColor="#888" />

        <Picker
            x:DataType="x:String"
            HeightRequest="50"
            ItemsSource="{Binding BindingContext.Filters, Source={x:Reference layout}}"
            SelectedItem="{Binding BindingContext.SelectedFilter, Source={x:Reference layout}}"
            ItemDisplayBinding="{Binding .}"
            TextColor="Black" />

        <ScrollView Margin="0">
            <Grid>

                <CollectionView
                    x:Name="monster_collection"
                    Margin="0"
                    ItemsSource="{Binding SearchedMonsters}"
                    SelectedItem="{Binding SelectedMonster}"
                    SelectionMode="Single"
                    IsVisible="{Binding ShowMonsters}">

                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="Models:Monster">
                            <Grid
                                HeightRequest="80"
                                Margin="0,4"
                                BackgroundColor="White"
                                VerticalOptions="Center">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>

                                <Label
                                    Grid.Column="0"
                                    Text="{Binding MonsterName}"
                                    FontAttributes="Bold"
                                    FontSize="16"
                                    TextColor="#333"
                                    VerticalTextAlignment="Center"
                                    Margin="8,0" />

                                <Label
                                    Grid.Column="1"
                                    Text="{Binding Hp}"
                                    FontAttributes="Bold"
                                    FontSize="14"
                                    TextColor="#666"
                                    VerticalTextAlignment="Center"
                                    HorizontalTextAlignment="End"
                                    Margin="8,0" />
                            </Grid>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>

                <CollectionView
                    x:Name="character_collection"
                    Margin="0"
                    ItemsSource="{Binding SearchedCharacters}"
                    SelectedItem="{Binding SelectedCharacter}"
                    SelectionMode="Single"
                    IsVisible="{Binding ShowCharacters}">

                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="Models:Character">
                            <Grid
                                HeightRequest="80"
                                Margin="0,4"
                                BackgroundColor="White"
                                VerticalOptions="Center">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>

                                <Label
                                    Grid.Column="0"
                                    Text="{Binding CharacterName}"
                                    FontAttributes="Bold"
                                    FontSize="16"
                                    TextColor="#333"
                                    VerticalTextAlignment="Center"
                                    Margin="8,0" />

                                <Label
                                    Grid.Column="1"
                                    Text="{Binding Hp}"
                                    FontAttributes="Bold"
                                    FontSize="14"
                                    TextColor="#666"
                                    VerticalTextAlignment="Center"
                                    HorizontalTextAlignment="End"
                                    Margin="8,0" />
                            </Grid>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>

            </Grid>
        </ScrollView>

    </VerticalStackLayout>
</toolkit:Popup>
